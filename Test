local Nofitication = {}

local GUI = game:GetService("CoreGui"):FindFirstChild("STX_Nofitication")

-- Constants
local WINDOW_WIDTH = 230
local WINDOW_HEIGHT_DEFAULT = 80
local WINDOW_HEIGHT_IMAGE = 90
local WINDOW_HEIGHT_OPTION = 110
local TITLE_PADDING_X = 8
local TITLE_PADDING_Y = 2
local DESC_PADDING_X = 8
local DESC_PADDING_Y = 34
local OUTLINE_HEIGHT = 2
local SHADOW_IMAGE_ID = "rbxassetid://1316045217"

-- Helper function to create UI elements
local function createInstance(instanceType, parent, properties)
    local instance = Instance.new(instanceType)
    instance.Parent = parent
    for prop, value in pairs(properties) do
        instance[prop] = value
    end
    return instance
end

function Nofitication:Notify(nofdebug, middledebug, all)
    local SelectedType = string.lower(tostring(middledebug.Type))
    local ambientShadow = createInstance("ImageLabel", GUI, {
        Name = "ambientShadow",
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0.915, 0, 0.937, 0),
        Size = UDim2.new(0, 0, 0, 0),
        Image = SHADOW_IMAGE_ID,
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.4,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118)
    })

    local Window = createInstance("Frame", ambientShadow, {
        Name = "Window",
        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 5, 0, 5),
        Size = UDim2.new(0, WINDOW_WIDTH, 0, WINDOW_HEIGHT_DEFAULT),
        ZIndex = 2
    })

    local Outline_A = createInstance("Frame", Window, {
        Name = "Outline_A",
        BackgroundColor3 = middledebug.OutlineColor,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 25),
        Size = UDim2.new(0, WINDOW_WIDTH, 0, OUTLINE_HEIGHT),
        ZIndex = 5
    })

    local WindowTitle = createInstance("TextLabel", Window, {
        Name = "WindowTitle",
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0, TITLE_PADDING_X, 0, TITLE_PADDING_Y),
        Size = UDim2.new(0, WINDOW_WIDTH - 8, 0, 22),
        ZIndex = 4,
        Font = Enum.Font.GothamSemibold,
        Text = nofdebug.Title,
        TextColor3 = Color3.fromRGB(220, 220, 220),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local WindowDescription = createInstance("TextLabel", Window, {
        Name = "WindowDescription",
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Position = UDim2.new(0, DESC_PADDING_X, 0, DESC_PADDING_Y),
        Size = UDim2.new(0, WINDOW_WIDTH - 12, 0, 40),
        ZIndex = 4,
        Font = Enum.Font.GothamSemibold,
        Text = nofdebug.Description,
        TextColor3 = Color3.fromRGB(180, 180, 180),
        TextSize = 12,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top
    })

    local function closeNotification()
        ambientShadow:TweenSize(UDim2.new(0, 0, 0, 0), "Out", "Linear", 0.2)
        wait(0.2)
        ambientShadow:Destroy()
    end

    ambientShadow:TweenSize(UDim2.new(0, 240, 0, (SelectedType == "option" and WINDOW_HEIGHT_OPTION) or (SelectedType == "image" and WINDOW_HEIGHT_IMAGE) or WINDOW_HEIGHT_DEFAULT), "Out", "Linear", 0.2)
    
    if SelectedType == "default" then
        wait(middledebug.Time)
        closeNotification()
        
    elseif SelectedType == "image" then
        local ImageButton = createInstance("ImageButton", Window, {
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 4, 0, 4),
            Size = UDim2.new(0, 18, 0, 18),
            ZIndex = 5,
            AutoButtonColor = false,
            Image = all.Image,
            ImageColor3 = all.ImageColor
        })

        wait(middledebug.Time)
        closeNotification()
        
    elseif SelectedType == "option" then
        local Uncheck = createInstance("ImageButton", Window, {
            Name = "Uncheck",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 7, 0, 76),
            Size = UDim2.new(0, 18, 0, 18),
            ZIndex = 5,
            AutoButtonColor = false,
            Image = "http://www.roblox.com/asset/?id=6031094678",
            ImageColor3 = Color3.fromRGB(255, 84, 84)
        })

        local Check = createInstance("ImageButton", Window, {
            Name = "Check",
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 28, 0, 76),
            Size = UDim2.new(0, 18, 0, 18),
            ZIndex = 5,
            AutoButtonColor = false,
            Image = "http://www.roblox.com/asset/?id=6031094667",
            ImageColor3 = Color3.fromRGB(83, 230, 50)
        })

        local Stilthere = true

        Uncheck.MouseButton1Click:Connect(function()
            pcall(all.Callback, false)
            closeNotification()
            Stilthere = false
        end)

        Check.MouseButton1Click:Connect(function()
            pcall(all.Callback, true)
            closeNotification()
            Stilthere = false
        end)

        wait(middledebug.Time)

        if Stilthere then
            closeNotification()
        end
    end
end

return Nofitication
